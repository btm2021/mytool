<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart - OHLCV Screener</title>
    
    <!-- Use libraries from parent directory -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="../vue.min.js"></script>
    <script src="../bootstrap-vue.min.js"></script>
    <script src="../ccxt.browser.js"></script>
    <script src="https://unpkg.com/lightweight-charts@4.2.1/dist/lightweight-charts.standalone.production.js"></script>
    
    <!-- Shared modules from parent -->
    <script src="../config.js"></script>
    <script src="../indicators.js"></script>
    <script src="../utils.js"></script>
    
    <!-- Chart styles -->
    <link rel="stylesheet" href="styles/chart.css">
    <link rel="stylesheet" href="styles/pnl.css">
    <link rel="stylesheet" href="styles/modal.css">

</head>

<body>
    <div class="chart-header">
        <div class="chart-title" id="chartTitle">Loading...</div>
        <div class="chart-info">
            <div class="info-item">
                <span class="info-label">PRICE</span>
                <span class="info-value" id="currentPrice">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">24H CHANGE</span>
                <span class="info-value" id="priceChange">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">24H HIGH</span>
                <span class="info-value" id="high24h">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">24H LOW</span>
                <span class="info-value" id="low24h">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">VOLUME</span>
                <span class="info-value" id="volume24h">-</span>
            </div>
        </div>
    </div>

    <div class="chart-controls">
        <button class="timeframe-btn" data-tf="1m">1m</button>
        <button class="timeframe-btn" data-tf="5m">5m</button>
        <button class="timeframe-btn active" data-tf="15m">15m</button>
        <button class="timeframe-btn" data-tf="1h">1h</button>
        <button class="timeframe-btn" data-tf="4h">4h</button>
        <button class="timeframe-btn" data-tf="1d">1D</button>
        <button class="timeframe-btn" id="pnlBtn" style="margin-left: 20px;">PNL</button>
        <button class="timeframe-btn" id="configBtn" style="margin-left: 10px;">⚙</button>
        <span id="pnlResult" style="margin-left: 10px; color: #ffb000; font-size: 12px;"></span>
        <div class="status-indicator">
            <span class="status-dot"></span>
            <span id="statusText">Connecting...</span>
        </div>
    </div>

    <div class="chart-container">
        <div id="chart"></div>
        <div class="pnl-panel">
            <h3>PNL CALCULATOR</h3>

            <div class="pnl-info-row">
                <span class="pnl-label">Entry:</span>
                <span class="pnl-value" id="pnlEntryPrice">-</span>
            </div>

            <div class="pnl-info-row">
                <span class="pnl-label">Exit:</span>
                <span class="pnl-value" id="pnlExitPrice">-</span>
            </div>

            <div class="pnl-divider"></div>

            <div class="pnl-info-row">
                <span class="pnl-label">Change:</span>
                <span class="pnl-value" id="pnlChange">-</span>
            </div>

            <div class="pnl-info-row">
                <span class="pnl-label">Change %:</span>
                <span class="pnl-value" id="pnlChangePercent">-</span>
            </div>

            <div class="pnl-divider"></div>

            <div class="pnl-leverage-input">
                <label>Leverage:</label>
                <input type="number" id="pnlLeverage" value="20" min="1" max="125" />
                <span style="color: #888; font-size: 11px;">x</span>
            </div>

            <div class="pnl-info-row" style="margin-top: 15px;">
                <span class="pnl-label">ROE %:</span>
                <span class="pnl-value" id="pnlROE">-</span>
            </div>

            <div class="pnl-divider"></div>

            <div class="pnl-info-row">
                <span class="pnl-label">PNL (2000x):</span>
                <span class="pnl-value" id="pnlAmount">-</span>
            </div>

            <div class="pnl-divider"></div>

            <div class="pnl-history">
                <h4>HISTORY</h4>
                <div class="pnl-table-wrapper">
                    <table class="pnl-history-table">
                        <thead>
                            <tr>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>ROE%</th>
                                <th>PNL</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody id="pnlHistoryBody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <div class="loading" id="loading">Loading chart data...</div>

    <!-- Config Modal -->
    <div class="modal" id="configModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>INDICATOR SETTINGS</h3>
                <button class="modal-close" id="closeModal">×</button>
            </div>
            <div class="modal-body">
                <div class="config-section">
                    <h4>
                        <label class="config-checkbox-label">
                            <input type="checkbox" id="showATRBot" checked />
                            ATR Bot
                        </label>
                    </h4>
                    <div class="config-row">
                        <label>ATR Length:</label>
                        <input type="number" id="atrLength" value="14" min="1" max="100" />
                    </div>
                    <div class="config-row">
                        <label>ATR Multiplier:</label>
                        <input type="number" id="atrMult" value="2.0" min="0.1" max="10" step="0.1" />
                    </div>
                    <div class="config-row">
                        <label>EMA Length:</label>
                        <input type="number" id="emaLength" value="30" min="1" max="200" />
                    </div>
                </div>

                <div class="config-section">
                    <h4>
                        <label class="config-checkbox-label">
                            <input type="checkbox" id="showVSR" checked />
                            VSR (Volume Support/Resistance)
                        </label>
                    </h4>
                    <div class="config-row">
                        <label>Length:</label>
                        <input type="number" id="vsrLength" value="20" min="1" max="100" />
                    </div>
                    <div class="config-row">
                        <label>Threshold:</label>
                        <input type="number" id="vsrThreshold" value="3.0" min="0.1" max="10" step="0.1" />
                    </div>
                </div>

                <div class="config-section">
                    <h4>
                        <label class="config-checkbox-label">
                            <input type="checkbox" id="showVWAP" checked />
                            VWAP
                        </label>
                    </h4>
                    <div class="config-row">
                        <label>Reset Period:</label>
                        <select id="vwapReset">
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                            <option value="none">None</option>
                        </select>
                    </div>
                </div>

                <div class="config-section">
                    <h4>
                        <label class="config-checkbox-label">
                            <input type="checkbox" id="showWMA" checked />
                            WMA (Weighted Moving Average)
                        </label>
                    </h4>
                    <div class="config-row">
                        <label>Period:</label>
                        <input type="number" id="wmaPeriod" value="60" min="1" max="200" />
                    </div>
                </div>

                <div class="config-section">
                    <h4>
                        <label class="config-checkbox-label">
                            <input type="checkbox" id="showHMA" checked />
                            HMA (Hull Moving Average)
                        </label>
                    </h4>
                    <div class="config-row">
                        <label>Period:</label>
                        <input type="number" id="hmaPeriod" value="60" min="1" max="200" />
                    </div>
                </div>

                <div class="config-section">
                    <h4>PNL Calculator</h4>
                    <div class="config-row">
                        <label>Initial Capital:</label>
                        <input type="number" id="initialCapital" value="2000" min="1" step="100" />
                        <span class="config-unit">USDT</span>
                    </div>
                    <div class="config-row">
                        <label>Default Leverage:</label>
                        <input type="number" id="defaultLeverage" value="20" min="1" max="125" />
                        <span class="config-unit">x</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-btn modal-btn-cancel" id="cancelConfig">Cancel</button>
                <button class="modal-btn modal-btn-save" id="saveConfig">Save</button>
            </div>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/indicators.js"></script>
    <script src="js/pnl.js"></script>
    <script src="js/chart.js"></script>
</body>

</html>