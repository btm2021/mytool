<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OHLCV Screener - Retro Terminal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.23.1/dist/bootstrap-vue.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles/variables.css">
    <link rel="stylesheet" href="styles/base.css">
    <link rel="stylesheet" href="styles/navbar.css">
    <link rel="stylesheet" href="styles/layout.css">
    <link rel="stylesheet" href="styles/exchange-panel.css">
    <link rel="stylesheet" href="styles/table.css">
    <link rel="stylesheet" href="styles/logs.css">
    <link rel="stylesheet" href="styles/system-tabs.css">
    <link rel="stylesheet" href="styles/modal.css">
</head>

<body>
    <div id="app">
        <nav class="navbar navbar-dark">
            <span class="navbar-brand">âš¡ OHLCV SCREENER - RETRO TERMINAL</span>
            <div class="navbar-controls">
                <button class="global-control-btn" @click="startAllWorkers" title="Start All">
                    <svg viewBox="0 0 24 24" class="control-icon">
                        <path d="M8 5v14l11-7z" fill="currentColor" />
                    </svg>
                </button>
                <button class="global-control-btn" @click="pauseAllWorkers" title="Pause All">
                    <svg viewBox="0 0 24 24" class="control-icon">
                        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" fill="currentColor" />
                    </svg>
                </button>
                <button class="global-control-btn" @click="stopAllWorkers" title="Stop All">
                    <svg viewBox="0 0 24 24" class="control-icon">
                        <rect x="6" y="6" width="12" height="12" fill="currentColor" />
                    </svg>
                </button>
            </div>
        </nav>

        <div class="container-fluid main-container">
            <div class="row h-100">
                <!-- Left Panel: Exchange Workers -->
                <div class="col-2 left-panel">
                    <div class="panel-title">EXCHANGES</div>
                    <div class="exchange-list">
                        <div v-for="exchange in enabledExchanges" :key="exchange.id" class="exchange-item"
                            :class="{'active': exchange.active, 'paused': exchange.paused}"
                            :style="{'border-left-color': exchange.color, 'color': exchange.color}">
                            <div class="exchange-header">
                                <span class="status-indicator" :class="getStatusClass(exchange)"
                                    :style="{color: exchange.color}"></span>
                                <div class="exchange-name clickable" :style="{color: exchange.color}"
                                    @click="openExchangeModal(exchange)">
                                    {{ exchange.name }}
                                </div>
                            </div>


                            <div class="exchange-info">

                                <div class="exchange-metric">
                                    <div class="metric-header">
                                        <span class="metric-label">Progress</span>
                                        <span class="metric-value">{{ exchange.processed }}/{{ exchange.total }}</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill"
                                            :style="{width: exchange.total > 0 ? (exchange.processed / exchange.total * 100) + '%' : '0%', background: exchange.color}">
                                        </div>
                                    </div>
                                </div>

                                <div class="exchange-metric">
                                    <div class="metric-header">
                                        <span class="metric-label">Weight</span>
                                        <span class="metric-value">{{ exchange.weight }}/{{ exchange.maxWeight }}</span>
                                    </div>
                                    <div class="metric-bar">
                                        <div class="metric-fill"
                                            :style="{width: (exchange.weight / exchange.maxWeight * 100) + '%', background: exchange.color}">
                                        </div>
                                    </div>
                                </div>

                                <div class="exchange-info-row">
                                    <span class="exchange-info-label">Symbols</span>
                                    <span class="exchange-symbols">{{ exchange.symbolCount }}</span>
                                </div>

                                <div class="exchange-info-row">
                                    <span class="exchange-info-label">Updated</span>
                                    <span class="exchange-last">{{ getLastUpdateTime(exchange) }}</span>
                                </div>
                            </div>
                            <div class="exchange-controls">
                                <button class="exchange-control-btn" @click="startExchange(exchange)"
                                    :disabled="exchange.active && !exchange.paused"
                                    :class="{'active': exchange.active && !exchange.paused}" title="Start">
                                    <svg viewBox="0 0 24 24" class="control-icon">
                                        <path d="M8 5v14l11-7z" fill="currentColor" />
                                    </svg>
                                </button>
                                <button class="exchange-control-btn" @click="pauseExchange(exchange)"
                                    :disabled="!exchange.active || exchange.paused" :class="{'active': exchange.paused}"
                                    title="Pause">
                                    <svg viewBox="0 0 24 24" class="control-icon">
                                        <path d="M6 4h4v16H6V4zm8 0h4v16h-4V4z" fill="currentColor" />
                                    </svg>
                                </button>
                                <button class="exchange-control-btn" @click="stopExchange(exchange)"
                                    :disabled="!exchange.active" title="Stop">
                                    <svg viewBox="0 0 24 24" class="control-icon">
                                        <rect x="6" y="6" width="12" height="12" fill="currentColor" />
                                    </svg>
                                </button>
                            </div>

                        </div>
                    </div>
                </div>

                <!-- Center Panel: Symbol Table with Tabs -->
                <div class="col-7 center-panel">
                    <div class="panel-header">
                        <div class="filter-container">
                            <input type="search" v-model="symbolFilter" placeholder="Filter symbols..."
                                class="filter-input">
                        </div>
                    </div>

                    <div class="tabs-container">
                        <div class="tab-buttons">
                            <button v-for="exchange in enabledExchanges" :key="exchange.id" class="tab-button"
                                :class="{'active': activeTab === exchange.id}" :style="getTabStyle(exchange)"
                                @click="activeTab = exchange.id">
                                {{ exchange.id.toUpperCase() }} ({{ getSymbolCount(exchange.id) }})
                            </button>
                        </div>

                        <div class="table-container">
                            <table class="symbol-table">
                                <thead>
                                    <tr>
                                        <th>Symbol</th>
                                        <th>Close</th>
                                        <th>RSI</th>
                                        <th>EMA50</th>
                                        <th>EMA200</th>
                                        <th>Signal</th>

                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="symbol in filteredSymbols" :key="symbol.symbol"
                                        :class="{'row-updated': symbol.updated}">
                                        <td class="symbol-name">
                                            <a :href="'chart.html?exchange=' + activeTab + '&symbol=' + symbol.symbol"
                                                target="_blank" class="symbol-link">
                                                <div class="symbol-icons">
                                                    <img :src="symbol.baseIcon" :alt="symbol.baseSymbol"
                                                        class="crypto-icon" loading="lazy" @error="handleIconError">
                                                    <span class="icon-separator">/</span>
                                                    <img :src="symbol.quoteIcon" :alt="symbol.quoteSymbol"
                                                        class="crypto-icon" loading="lazy" @error="handleIconError">
                                                </div>
                                                <span class="symbol-text">{{ symbol.displaySymbol }}</span>
                                            </a>
                                        </td>
                                        <td>{{ symbol.close }}</td>
                                        <td :class="getRsiClass(symbol.rsi)">{{ symbol.rsi }}</td>
                                        <td>{{ symbol.ema50 }}</td>
                                        <td>{{ symbol.ema200 }}</td>
                                        <td :class="'signal-' + symbol.signal">{{ symbol.signal }}</td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: System Tabs -->
                <div class="col-3 right-panel">
                    <div class="system-tabs">
                        <button class="system-tab-btn" :class="{'active': systemTab === 'logs'}"
                            @click="systemTab = 'logs'">
                            ðŸ“‹ LOGS
                        </button>
                        <button class="system-tab-btn" :class="{'active': systemTab === 'settings'}"
                            @click="systemTab = 'settings'">
                            âš™ SETTINGS
                        </button>
                    </div>

                    <!-- Logs Tab -->
                    <div v-show="systemTab === 'logs'" class="log-container">
                        <div v-for="(log, index) in logs" :key="index" class="log-line">
                            <span class="log-time">{{ log.time }}</span>
                            <span :class="'log-' + log.level">{{ log.message }}</span>
                        </div>
                    </div>

                    <!-- Settings Tab -->
                    <div v-show="systemTab === 'settings'" class="settings-container">
                        <!-- Exchange Enable/Disable -->
                        <div class="settings-section">
                            <div class="settings-section-title">Exchanges</div>
                            <div v-for="exchange in exchanges" :key="exchange.id" class="exchange-setting"
                                :style="{'border-left-color': exchange.color}">
                                <div>
                                    <div class="exchange-setting-name" :style="{color: exchange.color}">
                                        {{ exchange.name }}
                                    </div>
                                    <div class="exchange-setting-status">
                                        {{ settings.exchanges[exchange.id] ? 'Enabled' : 'Disabled' }}
                                    </div>
                                </div>
                                <label class="toggle-switch">
                                    <input type="checkbox" v-model="settings.exchanges[exchange.id]"
                                        @change="saveSettings">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <!-- Processing Settings -->
                        <div class="settings-section">
                            <div class="settings-section-title">Processing</div>
                            <div class="config-item">
                                <label class="config-label">Batch Size</label>
                                <input type="number" v-model.number="settings.batchSize" @change="saveSettings"
                                    class="config-input" min="1" max="50">
                            </div>
                            <div class="config-item">
                                <label class="config-label">Kline Limit</label>
                                <input type="number" v-model.number="settings.klineLimit" @change="saveSettings"
                                    class="config-input" min="20" max="1000">
                            </div>
                            <div class="config-item">
                                <label class="config-label">Timeframe</label>
                                <select v-model="settings.timeframe" @change="saveSettings" class="config-input">
                                    <option value="1m">1 minute</option>
                                    <option value="5m">5 minutes</option>
                                    <option value="15m">15 minutes</option>
                                    <option value="1h">1 hour</option>
                                    <option value="4h">4 hours</option>
                                </select>
                            </div>
                        </div>

                        <!-- Indicator Settings -->
                        <div class="settings-section">
                            <div class="settings-section-title">Indicators</div>
                            <div class="config-item">
                                <label class="config-label">RSI Period</label>
                                <input type="number" v-model.number="settings.rsi.period" @change="saveSettings"
                                    class="config-input" min="5" max="50">
                            </div>
                            <div class="config-item">
                                <label class="config-label">EMA Short</label>
                                <input type="number" v-model.number="settings.ema.short" @change="saveSettings"
                                    class="config-input" min="5" max="100">
                            </div>
                            <div class="config-item">
                                <label class="config-label">EMA Long</label>
                                <input type="number" v-model.number="settings.ema.long" @change="saveSettings"
                                    class="config-input" min="50" max="500">
                            </div>
                        </div>

                        <!-- Chart Settings -->
                        <div class="settings-section">
                            <div class="settings-section-title">Chart</div>
                            <div class="config-item">
                                <label class="config-label">Chart Candles Limit</label>
                                <input type="number" v-model.number="settings.chartCandlesLimit" @change="saveSettings"
                                    class="config-input" min="500" max="10000" step="500">
                                <div class="config-description">Number of candles to load in chart</div>
                            </div>
                        </div>

                        <button class="btn-reset" @click="resetSettings">Reset to Default</button>
                        <button class="btn-reset" @click="clearProcessedSymbols" style="margin-top: 10px;">Clear
                            Processed Symbols</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Exchange Symbols Modal -->
        <div v-if="showExchangeModal" class="modal-overlay" @click="closeExchangeModal">
            <div class="modal-content" @click.stop :style="{'border-color': selectedExchange.color}">
                <div class="modal-header"
                    :style="{'background': selectedExchange.color + '20', 'border-color': selectedExchange.color}">
                    <h3 :style="{color: selectedExchange.color}">{{ selectedExchange.name }} - Supported Symbols</h3>
                    <button class="modal-close" @click="closeExchangeModal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="modal-symbols-section">
                        <div class="modal-symbols-header">
                            <div class="modal-symbols-count">{{ modalFilteredSymbols.length }}/{{
                                selectedExchange.allSymbols.length }} symbols</div>
                            <input type="text" v-model="modalSymbolFilter" placeholder="Search symbols..."
                                class="modal-search">
                        </div>
                        <div class="modal-symbols-table">
                            <table class="modal-table">
                                <thead>
                                    <tr>
                                        <th style="width: 60px">#</th>
                                        <th>Symbol</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="(symbol, index) in modalFilteredSymbols" :key="symbol">
                                        <td class="symbol-index">{{ index + 1 }}</td>
                                        <td class="symbol-name">{{ symbol }}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.7.14/dist/vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-vue@2.23.1/dist/bootstrap-vue.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ccxt@4.2.25/dist/ccxt.browser.js"></script>
    <script src="config.js"></script>
    <script src="utils.js"></script>
    <script src="indicators.js"></script>
    <script src="app.js"></script>
</body>

</html>