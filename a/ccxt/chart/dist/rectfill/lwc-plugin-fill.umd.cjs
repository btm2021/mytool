(function(n,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("lightweight-charts")):typeof define=="function"&&define.amd?define(["exports","lightweight-charts"],l):(n=typeof globalThis<"u"?globalThis:n||self,l(n.FillRect={},n.LightweightCharts))})(this,function(n,l){"use strict";var y=Object.defineProperty;var R=(n,l,a)=>l in n?y(n,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):n[l]=a;var s=(n,l,a)=>(R(n,typeof l!="symbol"?l+"":l,a),a);function a(r,e,t){const i=Math.round(t*r),o=Math.round(t*e);return{position:Math.min(i,o),length:Math.abs(o-i)+1}}class w{constructor(e,t,i,o){s(this,"_p1");s(this,"_p2");s(this,"_fillColor");s(this,"_vertical",!1);this._p1=e,this._p2=t,this._fillColor=i,this._vertical=o}draw(e){e.useBitmapCoordinateSpace(t=>{if(this._p1===null||this._p2===null)return;const i=t.context;i.globalAlpha=.5;const o=a(this._p1,this._p2,this._vertical?t.verticalPixelRatio:t.horizontalPixelRatio);i.fillStyle=this._fillColor,this._vertical?i.fillRect(0,o.position,15,o.length):i.fillRect(o.position,0,o.length,15)})}}class _{constructor(e,t){s(this,"_source");s(this,"_p1",null);s(this,"_p2",null);s(this,"_vertical",!1);this._source=e,this._vertical=t}update(){[this._p1,this._p2]=this.getPoints()}renderer(){return new w(this._p1,this._p2,this._source.options.fillColor,this._vertical)}zOrder(){return"bottom"}}class m extends _{getPoints(){const e=this._source.series,t=e.priceToCoordinate(this._source.p1.price),i=e.priceToCoordinate(this._source.p2.price);return[t,i]}}class V extends _{getPoints(){const e=this._source.chart.timeScale(),t=e.timeToCoordinate(this._source.p1.time),i=e.timeToCoordinate(this._source.p2.time);return[t,i]}}class u{constructor(e,t){s(this,"_source");s(this,"_p");s(this,"_pos",null);this._source=e,this._p=t}coordinate(){return this._pos??-1}visible(){return this._source.options.showLabels}tickVisible(){return this._source.options.showLabels}textColor(){return this._source.options.labelTextColor}backColor(){return this._source.options.labelColor}movePoint(e){this._p=e,this.update()}}class d extends u{update(){const e=this._source.chart.timeScale();this._pos=e.timeToCoordinate(this._p.time)}text(){return this._source.options.timeLabelFormatter(this._p.time)}}class x extends u{update(){const e=this._source.series;this._pos=e.priceToCoordinate(this._p.price)}text(){return this._source.options.priceLabelFormatter(this._p.price)}}const C={fillColor:"rgba(200, 50, 100, 0.75)",labelColor:"rgba(200, 50, 100, 1)",labelTextColor:"white",showLabels:!0,priceLabelFormatter:r=>r.toFixed(2),timeLabelFormatter:r=>typeof r=="string"?r:(l.isBusinessDay(r)?new Date(r.year,r.month,r.day):new Date(r*1e3)).toLocaleDateString()};class g{constructor(e,t,i){s(this,"_p1");s(this,"_p2");s(this,"_fillColor");this._p1=e,this._p2=t,this._fillColor=i}draw(e){e.useBitmapCoordinateSpace(t=>{if(this._p1.x===null||this._p1.y===null||this._p2.x===null||this._p2.y===null)return;const i=t.context,o=a(this._p1.x,this._p2.x,t.horizontalPixelRatio),c=a(this._p1.y,this._p2.y,t.verticalPixelRatio);i.fillStyle=this._fillColor,i.fillRect(o.position,c.position,o.length,c.length)})}}class P{constructor(e){s(this,"_source");s(this,"_p1",{x:null,y:null});s(this,"_p2",{x:null,y:null});this._source=e}update(){const e=this._source.series,t=e.priceToCoordinate(this._source.p1.price),i=e.priceToCoordinate(this._source.p2.price),o=this._source.chart.timeScale(),c=o.timeToCoordinate(this._source.p1.time),h=o.timeToCoordinate(this._source.p2.time);this._p1={x:c,y:t},this._p2={x:h,y:i}}renderer(){return new g(this._p1,this._p2,this._source.options.fillColor)}}function f(r){if(r===void 0)throw new Error("Value is undefined");return r}class A{constructor(){s(this,"_chart");s(this,"_series");s(this,"_requestUpdate")}requestUpdate(){this._requestUpdate&&this._requestUpdate()}attached({chart:e,series:t,requestUpdate:i}){this._chart=e,this._series=t,this._series.subscribeDataChanged(this._fireDataUpdated),this._requestUpdate=i,this.requestUpdate()}detached(){this._chart=void 0,this._series=void 0,this._requestUpdate=void 0}get chart(){return f(this._chart)}get series(){return f(this._series)}_fireDataUpdated(e){this.dataUpdated&&this.dataUpdated(e)}}class b extends A{constructor(t,i,o={}){super();s(this,"_options");s(this,"_p1");s(this,"_p2");s(this,"_paneViews");s(this,"_timeAxisViews");s(this,"_priceAxisViews");s(this,"_priceAxisPaneViews");s(this,"_timeAxisPaneViews");this._p1=t,this._p2=i,this._options={...C,...o},this._paneViews=[new P(this)],this._timeAxisViews=[new d(this,t),new d(this,i)],this._priceAxisViews=[new x(this,t),new x(this,i)],this._priceAxisPaneViews=[new m(this,!0)],this._timeAxisPaneViews=[new V(this,!1)]}updateAllViews(){this._paneViews.forEach(t=>t.update()),this._timeAxisViews.forEach(t=>t.update()),this._priceAxisViews.forEach(t=>t.update()),this._priceAxisPaneViews.forEach(t=>t.update()),this._timeAxisPaneViews.forEach(t=>t.update())}priceAxisViews(){return this._priceAxisViews}timeAxisViews(){return this._timeAxisViews}paneViews(){return this._paneViews}priceAxisPaneViews(){return this._priceAxisPaneViews}timeAxisPaneViews(){return this._timeAxisPaneViews}autoscaleInfo(t,i){return this._timeCurrentlyVisible(this.p1.time,t,i)||this._timeCurrentlyVisible(this.p2.time,t,i)?{priceRange:{minValue:Math.min(this.p1.price,this.p2.price),maxValue:Math.max(this.p1.price,this.p2.price)}}:null}dataUpdated(t){}_timeCurrentlyVisible(t,i,o){const c=this.chart.timeScale(),h=c.timeToCoordinate(t);if(h===null)return!1;const p=c.coordinateToLogical(h);return p===null?!1:p<=o&&p>=i}get options(){return this._options}applyOptions(t){this._options={...this._options,...t},this.requestUpdate()}get p1(){return this._p1}get p2(){return this._p2}}n.FillRect=b,Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})});
