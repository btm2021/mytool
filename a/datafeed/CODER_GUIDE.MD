Binance Futures Screener System
ğŸ”· PHáº¦N 1. Má»¤C TIÃŠU Dá»° ÃN

XÃ¢y dá»±ng má»™t á»©ng dá»¥ng Screener Realtime cho dá»¯ liá»‡u Binance Futures,
bao gá»“m cÃ¡c tÃ­nh nÄƒng:

Thu tháº­p dá»¯ liá»‡u náº¿n 1m realtime (WebSocket).

LÆ°u trá»¯ vÃ o SQLite, tá»‘i Æ°u IO vÃ  dung lÆ°á»£ng.

CÃ³ API /ohlcv phá»¥c vá»¥ dá»¯ liá»‡u vÃ  resample Ä‘á»™ng.

CÃ³ thá»ƒ cáº¥u hÃ¬nh symbol/timeframe qua API POST.

CÃ³ há»‡ thá»‘ng kiá»ƒm tra dá»¯ liá»‡u Ä‘á»‹nh ká»³ (má»—i 1h).

Tá»± Ä‘á»™ng backfill dá»¯ liá»‡u bá»‹ thiáº¿u khi reconnect.

Táº£i sáºµn 50.000 Ä‘iá»ƒm dá»¯ liá»‡u 1m khi khá»Ÿi Ä‘á»™ng.

CÃ³ giao diá»‡n web realtime theo dÃµi tiáº¿n trÃ¬nh stream.

ğŸ”· PHáº¦N 2. Cáº¤U TRÃšC Dá»° ÃN
/src/
 â”œâ”€ datasources/
 â”‚   â”œâ”€ datasource_base.js
 â”‚   â””â”€ binance_future.js
 â”‚
 â”œâ”€ core/
 â”‚   â”œâ”€ db.js
 â”‚   â”œâ”€ aggregator.js
 â”‚   â”œâ”€ validator.js
 â”‚   â”œâ”€ utils.js
 â”‚
 â”œâ”€ api/
 â”‚   â”œâ”€ server.js
 â”‚   â”œâ”€ endpoints/
 â”‚   â”‚   â”œâ”€ ohlcv.js
 â”‚   â”‚   â”œâ”€ config.js
 â”‚   â”‚   â””â”€ stream.js
 â”‚
 â”œâ”€ web/
 â”‚   â”œâ”€ index.html
 â”‚   â”œâ”€ app.js
 â”‚   â””â”€ style.css
 â”‚
 â””â”€ config.json

ğŸ”· PHáº¦N 3. CHUáº¨N HÃ“A NGUá»’N Dá»® LIá»†U (DATASOURCE)
ğŸ”¹ File datasource_base.js

XÃ¢y dá»±ng lá»›p cÆ¡ sá»Ÿ cho má»i sÃ n:

export class DataSourceBase {
  connect() {}
  subscribe(symbols, interval) {}
  onMessage(callback) {}
  reconnect() {}
  backfill(symbol, fromTs, toTs) {}
  normalize(raw) {}
}

ğŸ”¹ File binance_future.js

WebSocket endpoint:
wss://fstream.binance.com/stream?streams=btcusdt@kline_1m/...

REST backfill:
https://fapi.binance.com/fapi/v1/klines?symbol=BTCUSDT&interval=1m&limit=1000&startTime=...

Chá»‰ emit khi "x": true (náº¿n Ä‘Ã³ng hoÃ n chá»‰nh).

Normalize dá»¯ liá»‡u vá» dáº¡ng chuáº©n:

{
  symbol: "BTCUSDT",
  exchange: "binance_futures",
  interval: "1m",
  ts: 1738747710000,
  open: 43210.5,
  high: 43300.1,
  low: 43120.0,
  close: 43250.0,
  volume: 120.35,
  closed: true
}


CÆ¡ cháº¿:

Kiá»ƒm tra vÃ  tá»± reconnect khi socket ngáº¯t.

Khi reconnect â†’ backfill dá»¯ liá»‡u bá»‹ thiáº¿u dá»±a vÃ o last_ts trong DB.

ğŸ”· PHáº¦N 4. DATABASE (SQLite)
Cáº¥u trÃºc báº£ng:
CREATE TABLE IF NOT EXISTS ohlcv (
  symbol TEXT,
  timeframe TEXT,
  ts INTEGER,
  open REAL,
  high REAL,
  low REAL,
  close REAL,
  volume REAL,
  PRIMARY KEY(symbol, timeframe, ts)
);

Ká»¹ thuáº­t tá»‘i Æ°u:
Ká»¹ thuáº­t	Má»¥c Ä‘Ã­ch
PRAGMA journal_mode=WAL;	cho phÃ©p ghi song song, trÃ¡nh khÃ³a toÃ n bá»™
PRAGMA synchronous=NORMAL;	cÃ¢n báº±ng tá»‘c Ä‘á»™ vÃ  Ä‘á»™ an toÃ n
Batch insert má»—i 60s	giáº£m sá»‘ láº§n ghi Ä‘Ä©a
Chá»‰ ghi khi náº¿n Ä‘Ã³ng (x=true)	trÃ¡nh ghi liÃªn tá»¥c má»—i 250ms
Sá»­ dá»¥ng Map cache	kiá»ƒm tra trÃ¹ng láº·p trÆ°á»›c khi ghi
Tá»± Ä‘á»™ng nÃ©n DB (gzip/ZSTD)	tiáº¿t kiá»‡m dung lÆ°á»£ng
XÃ³a dá»¯ liá»‡u quÃ¡ giá»›i háº¡n	giá»¯ tá»‘i Ä‘a 100k náº¿n/symbol
ğŸ”· PHáº¦N 5. QUY TRÃŒNH KHá»I Äá»˜NG

Äá»c config.json (symbol, timeframe, DB path).

Má»Ÿ káº¿t ná»‘i SQLite (tá»± táº¡o báº£ng náº¿u chÆ°a cÃ³).

Táº£i trÆ°á»›c 50.000 náº¿n 1m qua REST Binance cho má»—i symbol.

Ghi batch vÃ o DB (má»™t láº§n).

Káº¿t ná»‘i WebSocket â†’ báº¯t Ä‘áº§u thu realtime.

Khi "x": true" â†’ push vÃ o queue ghi DB.

Duy trÃ¬ heartbeat ping/pong Ä‘á»ƒ Ä‘áº£m báº£o káº¿t ná»‘i.

ğŸ”· PHáº¦N 6. CÆ  CHáº¾ Tá»° PHá»¤C Há»’I & KIá»‚M TRA
CÆ¡ cháº¿	MÃ´ táº£
Kiá»ƒm tra subscribe	má»—i 10s, kiá»ƒm tra stream cÃ²n hoáº¡t Ä‘á»™ng khÃ´ng.
Reconnect socket	náº¿u timeout >10s â†’ reconnect toÃ n bá»™.
Heartbeat ping/pong	má»—i 30s, náº¿u khÃ´ng cÃ³ pháº£n há»“i â†’ reconnect.
Backfill missing data	khi náº¿n "x":true", so sÃ¡nh last_ts trong DB. Náº¿u thiáº¿u â†’ fetch REST Ä‘á»ƒ bÃ¹.
Kiá»ƒm tra Ä‘á»‹nh ká»³ má»—i 1h	Ä‘á»c 60 náº¿n cuá»‘i, náº¿u tháº¥y thiáº¿u timestamp â†’ tá»± gá»i REST Ä‘á»ƒ bÃ¹.
Giá»›i háº¡n náº¿n lÆ°u trá»¯	náº¿u >100k náº¿n â†’ xÃ³a náº¿n cÅ© nháº¥t.
ğŸ”· PHáº¦N 7. API ENDPOINTS
ğŸ”¹ GET /ohlcv

Tráº£ dá»¯ liá»‡u náº¿n 1m hoáº·c timeframe resample.

/ohlcv?symbol=BTCUSDT&timeframe=15m&limit=500


Náº¿u timeframe=1m â†’ láº¥y trá»±c tiáº¿p tá»« DB.

Náº¿u timeframe khÃ¡c â†’ resample Ä‘á»™ng tá»« 1m trong bá»™ nhá»›.

Output:

[
 [timestamp, open, high, low, close, volume],
 ...
]

ğŸ”¹ POST /config

Cáº­p nháº­t symbol/timeframe runtime.

Request body:

{
  "symbols": ["BTCUSDT","ETHUSDT"],
  "intervals": ["1m"],
  "batch_interval": 60000
}


Server sáº½:

ÄÃ³ng WS cÅ©

Má»Ÿ WS má»›i

Reload láº¡i cáº¥u hÃ¬nh DB vÃ  tiáº¿n trÃ¬nh collector.

ğŸ”¹ WS /stream

Gá»­i dá»¯ liá»‡u realtime cho frontend:

{
  "symbol":"BTCUSDT",
  "interval":"1m",
  "o":43210,
  "h":43300,
  "l":43190,
  "c":43250,
  "v":120.5
}

ğŸ”· PHáº¦N 8. FRONTEND

WebSocket káº¿t ná»‘i /stream.

Hiá»ƒn thá»‹ báº£ng realtime:
| Symbol | Timeframe | Open | High | Low | Close | Volume | Status |

Log console:

Connected

Receiving

Parsed

Backfilling

Validated

CÃ³ form POST /config Ä‘á»ƒ cáº­p nháº­t symbol/timeframe ngay táº¡i UI.

ğŸ”· PHáº¦N 9. CÃC QUY TRÃŒNH Tá»I Æ¯U
ThÃ nh pháº§n	Ká»¹ thuáº­t
Collector	chá»‰ lÆ°u náº¿n "closed=true"
DB Writer	transaction bulk má»—i phÃºt
Memory cache	lÆ°u tráº¡ng thÃ¡i náº¿n cuá»‘i má»—i symbol
Backfill	chá»‰ fetch pháº§n thiáº¿u giá»¯a last_ts vÃ  now
Validator	tá»± sá»­a dá»¯ liá»‡u há»ng má»—i 1h
Compression	nÃ©n DB Ä‘á»‹nh ká»³
Limiter	xÃ³a dá»¯ liá»‡u cÅ© Ä‘á»ƒ giáº£m dung lÆ°á»£ng
API Layer	query index theo symbol + timeframe + ts
Resample	xá»­ lÃ½ ná»™i bá»™, khÃ´ng ghi DB
ğŸ”· PHáº¦N 10. Cáº¤U HÃŒNH Máº¶C Äá»ŠNH
{
  "symbols": ["BTCUSDT","ETHUSDT"],
  "intervals": ["1m"],
  "database_path": "./data/ohlcv.db",
  "batch_interval": 60000,
  "max_records": 100000,
  "bootstrap_load": 50000
}

ğŸ”· PHáº¦N 11. LUá»’NG HOáº T Äá»˜NG
[Khá»Ÿi Ä‘á»™ng] â†’ Äá»c config â†’ Táº£i 50.000 náº¿n 1m
       â†“
[LÆ°u DB] â†’ Má»Ÿ WebSocket Binance
       â†“
[Nháº­n náº¿n realtime] â†’ náº¿u "x":true â†’ ghi batch vÃ o DB
       â†“
[Má»—i 10s] â†’ kiá»ƒm tra subscribe
[Má»—i 1h] â†’ validator kiá»ƒm tra tÃ­nh liÃªn tá»¥c
       â†“
[Náº¿u máº¥t WS] â†’ reconnect + backfill tá»« last_ts

ğŸ”· PHáº¦N 12. YÃŠU Cáº¦U TRIá»‚N KHAI

KhÃ´ng viáº¿t file test hoáº·c demo.

Chá»‰ dÃ¹ng ES Modules (import/export).

KhÃ´ng dÃ¹ng ORM, chá»‰ better-sqlite3.

KhÃ´ng sá»­ dá»¥ng cron, dÃ¹ng setInterval.

TÃ¡ch module rÃµ rÃ ng.

Ghi log tá»‘i giáº£n.

KhÃ´ng dÃ¹ng framework frontend phá»©c táº¡p (HTML + JS thuáº§n).

ToÃ n bá»™ datasource pháº£i normalize theo cÃ¹ng format.

Äáº£m báº£o IO tháº¥p vÃ  kháº£ nÄƒng má»Ÿ rá»™ng sau nÃ y.

ğŸ”· PHáº¦N 13. Káº¾T QUáº¢ MONG Äá»¢I

Khi cháº¡y npm start:

Táº£i 50.000 náº¿n 1m ban Ä‘áº§u tá»« Binance Futures.

Ghi dá»¯ liá»‡u vÃ o SQLite.

Káº¿t ná»‘i WebSocket â†’ nháº­n náº¿n realtime "x":true".

Ghi batch Ä‘á»‹nh ká»³ má»—i phÃºt.

Endpoint /ohlcv hoáº¡t Ä‘á»™ng chÃ­nh xÃ¡c (tá»± resample).

CÃ³ thá»ƒ POST /config Ä‘á»ƒ reload symbol/timeframe mÃ  khÃ´ng restart app.

Validator tá»± kiá»ƒm tra dá»¯ liá»‡u má»—i 1h.

Frontend hiá»ƒn thá»‹ realtime tiáº¿n trÃ¬nh.

ğŸ”· PHáº¦N 14. TÃ“M Táº®T NHIá»†M Vá»¤ CHO AI CODER

HÃ£y táº¡o má»™t há»‡ thá»‘ng Node.js hoÃ n chá»‰nh cÃ³ cÃ¡c chá»©c nÄƒng sau:

Thu tháº­p dá»¯ liá»‡u náº¿n 1m tá»« Binance Futures qua WebSocket.

LÆ°u batch vÃ o SQLite vá»›i tá»‘i Æ°u IO.

CÃ³ endpoint /ohlcv?symbol=...&timeframe=...&limit=....

CÃ³ API POST /config Ä‘á»ƒ reload cáº¥u hÃ¬nh.

CÃ³ cÆ¡ cháº¿ backfill dá»¯ liá»‡u thiáº¿u vÃ  reconnect socket.

CÃ³ validator tá»± Ä‘á»™ng cháº¡y má»—i 1h Ä‘á»ƒ kiá»ƒm tra tÃ­nh toÃ n váº¹n.

CÃ³ frontend realtime hiá»ƒn thá»‹ tiáº¿n trÃ¬nh.

Táº£i sáºµn 50.000 Ä‘iá»ƒm dá»¯ liá»‡u khi khá»Ÿi Ä‘á»™ng.

ToÃ n bá»™ module Ä‘á»™c láº­p, cÃ³ thá»ƒ má»Ÿ rá»™ng thÃªm sÃ n khÃ¡c sau nÃ y.

LÆ°u Ã½ dÃ¹ng cÃ¡c kÄ© thuáº­t Ä‘á»ƒ trÃ¡nh limit cá»§a cÃ¡c exchange.